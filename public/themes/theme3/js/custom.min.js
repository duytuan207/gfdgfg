function numberCopy(data) {
    let _this = $(data.trigger);
    swal({
        title: "Thông báo",
        text: `Đã sao chép số điện thoại ${data.text} ${_this.data("name")}\nVui lòng cược tối thiểu ${Intl.NumberFormat("en-US").format(_this.data("min"))}đ và tối đa ${Intl.NumberFormat("en-US").format(_this.data("max"))}đ\nChúc bạn may mắn ❤\nTrả thưởng chỉ 5 giây!`,
        icon: "success",
        timer: 1e4
    }).then(()=>swal("HÃY CHÚ Ý", "SỐ TRẢ THƯỞNG CHỈ DÙNG ĐỂ TRẢ THƯỞNG,\n KHÔNG ĐÁNH VÀO SỐ TRẢ THƯỞNG NHA!", "warning"))
}
function loadGame(err, response) {
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && ($("#list-game").html(""),
    response.data.map((data,index)=>{
        $("#list-game").append(`<button class="btn btn-${0 == index ? "primary" : "default"} mt-1 rounded-pill games" data-name="${data.name}" data-description="${data.description}" data-type="${data.gameType}">${data.name}</button>`)
    }
    ))
}
function loadReward(err, response) {
    let colors = ["comment-red", "comment-green", "comment-blue", "comment-orange"]
      , dataGame = $(".games.btn-primary");
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && ($("#gameNoti").html(dataGame.data("description")),
    $("#tableReward").html(""),
    response.data.map(data=>{
        $("#tableReward").append(`<tr><td><span class="fa-stack"><span class="fa fa-circle fa-stack-2x ${colors[Math.floor(Math.random() * colors.length)]}"></span><span class="fa-stack-1x text-white">${data.content}</span></span></td><td><code>${data.numberTLS.join("</code> - <code>")}</code></td><td><b>x ${data.amount} tiền cược</b></td></tr>`)
    }
    ))
}
function loadPhone(err, response) {
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && ($("#tablePhone, #tableStatus").html(""),
    response.data.map(data=>{
        "active" == data.status && (data.amountDay + 2 * data.betMax >= data.limitDay || data.amountMonth + 2 * data.betMax >= data.limitMonth || data.count + 10 >= data.number) && (data.status = "pendingStop"),
        $("#tablePhone").append(`<tr><td><b>${data.phone}</b> <span class="label label-success text-uppercase copy-text" data-clipboard-text="${data.phone}" data-name="${data.name}" data-min="${data.betMin}" data-max="${data.betMax}"><i class="fa fa-clipboard" aria-hidden="true"></i></span><br><b class="text-phone"><font color="green">${Intl.NumberFormat("en-US").format(data.amountDay)}</font>/<font color="6861b1">${convertCurrency(data.limitDay)}</font> ~ <font color="blue">${data.count}</font>/<font color="6861b1">${data.number}</font></b></td><td>${Intl.NumberFormat("en-US").format(data.betMin)} VNĐ</td><td>${Intl.NumberFormat("en-US").format(data.betMax)} VNĐ</td> </tr>`),
        $("#tableStatus").append(`<tr><td><b>${data.phone}</b> <span class="label label-success text-uppercase copy-text" data-clipboard-text="${data.phone}" data-name="${data.name}" data-min="${data.betMin}" data-max="${data.betMax}"><i class="fa fa-clipboard" aria-hidden="true"></i></span></td><td>${"active" == data.status ? '<span class="label label-success text-uppercase">Hoạt động</span>' : "pendingStop" == data.status ? '<span class="label label-warning text-uppercase">Sắp bảo trì</span>' : '<span class="label label-danger text-uppercase">Bảo trì</span>'}</td><td><b style="color:blue;font-size: 12px;">${Intl.NumberFormat("en-US").format(data.count)}</b></td><td>${Intl.NumberFormat("en-US").format(data.amountDay)} VNĐ</td></tr>`)
    }
    ))
}
function loadHistory(err, response) {
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && ($("#tableHistory").html(""),
    response.data.map(data=>{
        $("#tableHistory").append(`<tr><td>${data.phone}</td><td>${Intl.NumberFormat("en-US").format(data.amount)}</td><td>${data.transId}</td><td>${data.transIdPlus}</td><td><b><font color="red">${data.transIdNew}</b></font></td><td>${data.gameName}</td><td>${data.content}</td>${"win" == data.status ? '<td><span class="label label-success text-uppercase">Thắng</span></td>' : '<td><span class="label label-danger text-uppercase">Thua</span></td>'}</tr>`)
    }
    ))
}
function loadMission(action, err, response) {
    "start" != action ? (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    $("#checkMission button").prop("disabled", !1).html("Kiểm Tra"),
    $(".result-mission").remove(),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && $("#checkMission").append(`<div class="form-group box-success result-mission"><h5 class="text-red">Xin Chào </h5><h4>${response.data.name}</h4><p style="color:blue;">Bạn đã chơi : ${Intl.NumberFormat("en-US").format(response.data.count)}đ</p></div>`)) : $("#checkMission button").prop("disabled", !0).html("Đang truy vấn...")
}
function loadMuster(err, response) {
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && response.data && ($("#muster-session").html(`#${response.data.code}`),
    $(".muster-count").html(Intl.NumberFormat("en-US").format(response.data.count)),
    $("#muster-winner").html(response.data.win),
    $("#muster-bonus").html(`${Intl.NumberFormat("en-US").format(response.data.bonus)}`),
    $(".muster-time").html(response.data.second))
}
function loadHistoryMuster(err, response) {
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success && ($("#tableMuster").html(""),
    response.data.map(data=>{
        $("#tableMuster").append(`<tr><td><small>#${data.code}</small></td><td>${data.phone}</td><td>${Intl.NumberFormat("en-US").format(data.amount)}</td></tr>`)
    }
    ))
}
function addMuster(action="start", err, response) {
    "start" != action ? (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    $("#addMuster button").prop("disabled", !1).html("Điểm danh"),
    !err && swal("Thông Báo", response.message, response.success ? "success" : "error")) : $("#addMuster button").prop("disabled", !0).html("Đang xử lý...")
}
function checkGift(action="start", err, response) {
    "start" != action ? (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    $("#checkGift button").prop("disabled", !1).html("Kiểm tra"),
    !err && swal("Thông Báo", response.message, response.success ? "success" : "error")) : $("#checkGift button").prop("disabled", !0).html("Đang xử lý...")
}
function checkByPhone(transId) {
    swal({
        text: "Bạn đã chuyển tiền đến số nào trên hệ thống",
        content: {
            element: "input",
            attributes: {
                placeholder: "Nhập số bạn đã chuyển tiền trên hệ thống",
                type: "number"
            }
        },
        buttons: [!0, "Tìm tiếp"],
        icon: "https://i.imgur.com/52hY3gx.png"
    }).then(result=>{
        result && axios.post("../api/v2/checkTransId", {
            phone: result,
            transId: transId
        }).then(res=>{
            loadTransId(null, res.data)
        }
        ).catch(err=>{
            loadTransId(err, null)
        }
        )
    }
    )
}
function loadTransId(err, response) {
    if (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    response.success) {
        let status, refund, data = response.data;
        switch (data.status) {
        case "wait":
            status = "Đang xử lý";
            break;
        case "done":
            status = "Đã xử lý";
            break;
        case "limitBet":
            refund = !0,
            status = "Sai hạn mức";
            break;
        case "errorComment":
            refund = !0,
            status = "Sai nội dung (không hỗ trợ hoàn tiền)";
            break;
        case "limitRefund":
            status = "Giới hạn hoàn";
            break;
        default:
            status = "Lỗi xử lý"
        }
        $(".transId-refund").remove(),
        refund && $("#modalDetail .modal-footer"),
        $("#modalDetail .modal-body").html(`<p>Mã GD Momo + Miliseconds : <b style="color:#00cc66;">${data.transId}</b></p><p>GD New : <b style="color:red;">${data.transIdNew}</b></p><p>SĐT: <b style="color:brown;">${data.phone}</b></p><p>Số Tiền: <b style="color:#ff0066;">${Intl.NumberFormat("en-US").format(data.amount)} VNĐ</b></p><p>Nội Dung: <b style="color:blue;">${data.comment}</b></p><hr><h3 class="text-success"><b>Thông Tin Trò Chơi</b></h3><div style="margin: 0px; float: center; border: 1px dashed rgb(226, 93, 219); padding: 5px;"><p>Loại Trò Chơi: <b style="color:#ff0066;">${data.gameName}</b></p><p>Kết Quả: <b style="color:#00cc66;">${"unknown" == data.result ? "Không xác định" : "win" == data.result ? "Thắng" : "Thua"}</b></p><p>Tiền Nhận: <b style="color:#ff0066;">${Intl.NumberFormat("en-US").format(data.bonus)} VNĐ</b></p><p>Trạng Thái: <b style="color:#0000ff;">${status}</b></p><p>Thời Gian: <b style="color:#000000;">${data.time}</b></p></div>`),
        $("#modalDetail").modal("show")
    }
}
function refundTransId(action="start", err, response) {
    "start" != action ? ($("#modalDetail").modal("hide"),
    $("#modalDetail .transId-refund").remove(),
    err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !err && swal("Thông Báo", response.message, response.success ? "success" : "error")) : $("#modalDetail .transId-refund").prop("disabled", !0).html("Đang xử lý...")
}
function jackpotCheck(action="start", err, response) {
    "start" != action ? (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    !response.success && swal("Thông Báo", response.message, "error"),
    $("#jackpot button").html("Tham Gia").prop("disabled", !1),
    response.success && $("#jackpot button").attr("data-action", 1 == response.data.isJoin ? "out" : "join").html(1 == response.data.isJoin ? "Huỷ" : "Tham Gia").prop("disabled", !1)) : $("#jackpot button").html("Đang xử lý...").prop("disabled", !0)
}
function jackpotAction(action="start", err, response) {
    "start" != action ? (err && swal("Thông Báo", `Có lỗi xảy ra ${err.message}`, "warning"),
    $('#jackpot input[name="phone"]').val(""),
    $("#jackpot button").html("Tham Gia").prop("disabled", !1),
    !err && swal("Thông Báo", response.message, response.success ? "success" : "error")) : $("#jackpot button").html("Đang xử lý...").prop("disabled", !0)
}
function colorComment() {
    $(".color-comment").each((function() {
        $(this).css("color", `#${Math.floor(16777215 * Math.random()).toString(16)}`)
    }
    ))
}
$(document).ready((function(e) {
    typingEffect("#mainTitle", [$("#mainTitle").data("text")]),
    setInterval(colorComment, 1e3),
    $("body").on("click", ".games", (function(e) {
        $("html, body").animate({
            scrollTop: $(".box-cl").offset().top
        }, 500)
    }
    )),
    $("body").on("click", ".games[data-type]", (function(e) {
        $('.tab-panel[data-type="game"]').show(),
        $('.tab-panel[data-type="mini-game"]').hide()
    }
    )),
    $("body").on("click", "button[data-game]", (function(e) {
        let game = $(this).data("game");
        $('.tab-panel[data-type="game"]').hide(),
        $('.tab-panel[data-type="mini-game"]').hide(),
        $(`.tab-panel[data-type="mini-game"][data-name="${game}"]`).show()
    }
    )),
    $("body").on("click", ".button-muster", (function(e) {
        let id = $(this).data("key");
        $("#muster-guide").hide(),
        $("#muster-history").hide(),
        $(`#${id}`).show()
    }
    )),
    $("body").on("click", "#checkTransId button", (function(e) {
        let transId = $('#checkTransId input[name="transId"]').val();
        axios.post("../api/v2/checkTransId", {
            transId: transId
        }).then(res=>{
            (!res.data.success && res.data.data) ? checkByPhone(transId) : loadTransId(null, res.data)
        }
        ).catch(err=>{
            loadTransId(err, null)
        }
        )
    }
    )),
    $("body").on("click", "#jackpot button", (function(e) {
        let action = $("#jackpot button").attr("data-action")
          , phone = $('#jackpot input[name="phone"]').val();
        if (!action)
            return swal("Thông Báo", "Thiếu dữ liệu hoặc lỗi!", "warning");
        jackpotAction(),
        axios.post(`../api/v2/jackpot/${action}`, {
            phone: phone
        }).then(res=>{
            jackpotAction(null, null, res.data)
        }
        ).catch(err=>{
            jackpotAction(null, err)
        }
        )
    }
    )),
    $("body").on("click", ".transId-refund", (function(e) {
        let transId = $(this).data("id");
        if (!transId)
            return swal("Thông Báo", "Có lỗi xảy ra, hãy thử lại!", "warning");
        refundTransId(),
        axios.post("../api/v2/refundTransId", {
            transId: transId
        }).then(res=>{
            refundTransId(null, null, res.data)
        }
        ).catch(err=>{
            refundTransId(null, err, null)
        }
        )
    }
    ))
}
));
